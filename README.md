# 🛒 内购系统

一个基于Streamlit构建的企业内部商品购买管理系统。

## ✨ 主要功能

- 📦 **商品管理**：批量导入Excel/CSV，库存统计
- 🛒 **购物下单**：表格式购买，支持条码管理
- 💰 **灵活支付**：现金/内购券/混合支付
- 📋 **订单管理**：历史查询，在线修改
- 📊 **数据统计**：销售分析，可视化图表

## 🚀 在线体验

**应用地址**: [点击访问](your-streamlit-app-url)

## 👤 登录方式

- **管理员**：输入"管理员"
- **普通用户**：输入任意姓名（自动注册）

## 📋 商品导入格式

支持Excel(.xlsx)和CSV格式，表头：
- 条码 (必填)
- 商品名称 (必填)  
- 价格 (必填)
- 库存 (必填)
- 描述 (可选)

## 💰 支付规则

- ✅ 支持现金、内购券、混合支付
- ✅ 允许超额支付（不找零）
- ❌ 不允许支付不足

## 🔧 技术栈

- **前端**: Streamlit
- **数据**: Pandas + JSON
- **Excel**: openpyxl

## 📸 功能截图

### 管理员界面
- 库存管理：批量导入、表格显示、统计分析
- 订单管理：详细信息、支付统计、数据导出

### 用户界面  
- 商品购买：条码显示、库存状态、购物车
- 订单历史：历史查询、在线修改、订单撤销

## 📂 项目结构

```
内购系统/
├── app.py                # 主应用
├── requirements.txt      # 依赖包
├── .streamlit/          # 配置
├── 商品导入模板.csv     # 导入模板
└── README.md            # 说明文档
```

## 📄 开源协议

MIT License

## 系统概述
这是一个基于 Streamlit 的内购系统，支持商品管理、订单管理、用户管理等功能。

## 功能特点
- ✅ **批量导入**：支持Excel/CSV文件导入商品
- ✅ **一键清空**：每次内购活动结束后可清空所有商品
- ✅ 用户购买下单
- ✅ 支付方式选择（现金支付/内购券支付）
- ✅ **灵活支付规则**：允许超额支付（内购券不退差额），但不允许不足支付
- ✅ 实时库存更新
- ✅ 订单统计导出
- ✅ 用户权限管理
- ✅ 数据可视化统计
- ✅ **订单历史**：用户可查看自己的历史订单
- ✅ **订单修改**：用户可修改已提交的订单（数量、增加商品、撤销）
- ✅ **库存联动**：订单修改时自动更新库存
- ✅ **销售统计**：库存管理显示每个商品的销售数量
- ✅ **详细订单管理**：完整显示订单和商品信息，便于管理和导出

## 安装运行

### 1. 安装依赖
```bash
pip install -r requirements.txt
```

### 2. 运行系统
```bash
streamlit run app.py
```

## 登录方式
- **任何姓名**都可以直接登录使用系统
- **管理员**需要输入"管理员"才能获得管理权限
- 首次使用某个姓名登录时，系统会自动创建普通用户账户

## 使用流程

### 管理员操作
1. 输入"管理员"登录
2. 在"库存管理"中批量导入商品（支持Excel/CSV）
3. 查看商品库存、销售数量等统计信息
4. 可以一键清空所有商品（适合每次内购活动）
5. 在"订单管理"中查看所有订单
6. 在"用户管理"中查看用户信息
7. 在"数据统计"中查看销售统计

### 普通用户操作
1. 输入任何姓名登录（如：张三、李四、小明等）
2. 浏览商品列表
3. 将商品加入购物车
4. 选择支付方式（现金支付/内购券支付）
5. 提交订单
6. **查看订单历史**：在"订单历史"选项卡中查看历史订单
7. **修改订单**：
   - 修改商品数量（可以减少或增加到库存允许范围内）
   - 从库存中增加新商品到现有订单
   - 撤销整个订单（恢复库存）
   - 重新设置支付方式

## 数据存储
系统使用 JSON 文件存储数据：
- `inventory.json`: 商品库存数据
- `orders.json`: 订单数据
- `users.json`: 用户数据

## 商品导入
管理员可以通过批量导入方式添加商品：
1. 支持Excel (.xlsx) 和 CSV (.csv) 格式文件
2. 使用提供的模板文件

文件格式要求：
```
条码,商品名称,价格,库存,描述
MAC001,苹果MacBook Pro,12999.00,5,M2芯片 8GB+256GB
```

支持的列名：
- 中文：条码、商品名称、价格、库存、描述
- 英文：barcode/code、name、price、stock、description

**注意：** 如果导入时没有条码字段，系统会自动生成条码

## 数据导出
系统支持导出订单数据为 CSV 格式，包含：
- 订单ID
- 用户姓名
- 商品信息
- 总金额
- 支付方式
- 下单时间

## 注意事项
1. 系统会自动检查库存，防止超卖
2. 购物车中的商品会实时检查库存状态
3. 订单提交后会自动扣减库存
4. 管理员账户不能被删除

## 技术栈
- **前端**: Streamlit
- **数据处理**: Pandas
- **数据存储**: JSON 文件
- **图表**: Streamlit 内置图表

## 部署说明
由于使用 Streamlit 和本地文件存储，可以：
1. 在本地运行用于内网使用
2. 部署到云服务器供外网访问
3. 使用 Streamlit Community Cloud 免费部署

## 扩展功能
未来可以扩展的功能：
- 商品图片上传
- 邮件通知
- 库存预警
- 批量操作
- 数据备份
- 权限细化
