# 支付规则优化说明

## 新的支付验证规则

### 背景
内购系统的支付方式包括现金和内购券，根据实际业务需求，内购券不退差额，因此需要调整支付验证逻辑。

### 新的支付规则

#### 1. 允许超额支付
- **现金支付**：允许超额支付（例如找零）
- **内购券支付**：允许超额支付（不退差额）
- **混合支付**：允许总支付金额大于订单金额

#### 2. 不允许不足支付
- 支付总金额不能小于订单金额
- 系统会显示错误提示："支付金额不足"

#### 3. 支付状态提示
- **金额相等**：显示绿色成功提示
- **超额支付**：显示黄色警告提示，说明多付差额不找零
- **金额不足**：显示红色错误提示，阻止提交订单

### 实现细节

#### 验证逻辑
```python
if payment_total < total_amount:
    # 错误：支付不足
    st.error("支付金额不足")
    payment_valid = False
else:
    if payment_total > total_amount:
        # 警告：超额支付
        st.warning("支付金额大于订单总额，多付差额不找零")
    else:
        # 成功：金额相等
        st.success("支付金额正确")
    payment_valid = True
```

#### 数据记录
系统会记录以下信息：
- `total_amount`：订单商品总金额
- `cash_amount`：实际现金支付金额
- `voucher_amount`：实际内购券支付金额
- `actual_payment`：实际支付总金额（新增字段）

### 适用场景

#### 商品购买
- 用户下单时应用新的支付验证规则
- 支持超额支付，不退差额

#### 订单修改
- 修改订单时同样应用新的支付验证规则
- 重新设置支付方式时遵循相同规则

### 用户体验

#### 提示信息
1. **支付不足**：明确提示需要补足金额
2. **金额正确**：绿色提示确认支付金额
3. **超额支付**：黄色警告说明不退差额

#### 操作流程
1. 用户输入现金和内购券金额
2. 系统实时验证支付金额
3. 显示相应的状态提示
4. 只有支付金额足够时才允许提交订单

---
*此优化符合内购券不退差额的业务规则，提升了系统的实用性。*
